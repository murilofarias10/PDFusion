{% extends 'base.html' %}
{% block title %}Processing PDFs{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center mb-4">Processing Your PDFs</h2>

    <!-- Progress Bar -->
    <div class="progress mb-4">
        <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated"
             role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
    </div>

    <!-- Status Message -->
    <div id="status-message" class="alert alert-info text-center">
        Starting PDF processing...
    </div>

    <!-- Step List -->
    <div class="card">
        <div class="card-header">
            Processing Steps
        </div>
        <ul class="list-group list-group-flush" id="processing-steps">
            <li class="list-group-item" id="step-upload">1. Uploading Files <span class="badge bg-secondary float-end">Waiting</span></li>
            <li class="list-group-item" id="step-extract">2. Extracting Content <span class="badge bg-secondary float-end">Waiting</span></li>
            <li class="list-group-item" id="step-compare">3. Comparing Documents <span class="badge bg-secondary float-end">Waiting</span></li>
            <li class="list-group-item" id="step-ai">4. Analyzing Differences (AI) <span class="badge bg-secondary float-end">Waiting</span></li>
            <li class="list-group-item" id="step-render">5. Rendering Output <span class="badge bg-secondary float-end">Waiting</span></li>
        </ul>
    </div>
</div>

<script>
    const steps = ['upload', 'extract', 'compare', 'ai', 'render'];
    let progress = 0;
    let currentStep = 0;

    function updateStep(step, status) {
        const item = document.getElementById(`step-${step}`);
        const badge = item.querySelector('.badge');
        if (status === 'done') {
            badge.className = 'badge bg-success float-end';
            badge.innerText = 'Completed';
        } else if (status === 'active') {
            badge.className = 'badge bg-primary float-end';
            badge.innerText = 'In Progress';
        }
    }

    function nextStep() {
        if (currentStep >= steps.length) {
            document.getElementById('status-message').className = 'alert alert-success text-center';
            document.getElementById('status-message').innerText = "All steps completed. Redirecting...";
            setTimeout(() => window.location.href = "/process", 2000);
            return;
        }

        const step = steps[currentStep];
        updateStep(step, 'active');
        document.getElementById('status-message').innerText = `Step ${currentStep + 1}: ${step.charAt(0).toUpperCase() + step.slice(1)}...`;

        setTimeout(() => {
            updateStep(step, 'done');
            currentStep++;
            progress += 20;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            document.getElementById('progress-bar').innerText = `${progress}%`;
            nextStep();
        }, 1000);
    }

    document.addEventListener('DOMContentLoaded', () => {
        nextStep();
    });
</script>
{% endblock %}