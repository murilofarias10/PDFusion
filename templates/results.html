{% extends 'base.html' %}
{% block title %}Comparison Results{% endblock %}
{% block content %}
<h3 class="text-center mb-4">Comparison Results</h3>

{% if show_visual %}
<div class="row mb-4">
    <div class="col-md-6">
        <h5 class="text-danger">PDF A - Red Highlights (Deletions)</h5>
        <div class="border rounded p-2 position-relative" style="overflow:auto; max-height:80vh;">
            <img id="img1" src="{{ url_for('get_image', filename='pdf_a_highlighted.png') }}"
                 class="img-fluid" style="transform-origin: top left; transition: transform 0.3s;">
        </div>
    </div>
    <div class="col-md-6">
        <h5 class="text-success">PDF B - Green Highlights (Additions)</h5>
        <div class="border rounded p-2 position-relative" style="overflow:auto; max-height:80vh;">
            <img id="img2" src="{{ url_for('get_image', filename='pdf_b_highlighted.png') }}"
                 class="img-fluid" style="transform-origin: top left; transition: transform 0.3s;">
        </div>
    </div>
</div>

<!-- Zoom Controls -->
<div class="text-center mt-3 mb-5">
    <button class="btn btn-outline-primary me-2" onclick="zoomIn()">Zoom In</button>
    <button class="btn btn-outline-primary me-2" onclick="zoomOut()">Zoom Out</button>
    <button class="btn btn-outline-secondary me-2" onclick="resetZoom()">Reset</button>
    <input type="number" id="zoomInput" value="100" min="25" max="500" step="5"
           class="form-control d-inline-block text-center" style="width: 80px;" onchange="setZoom(this.value)"> %
</div>
{% endif %}

{% if diff_ready and not show_visual %}
<div class="row">
    <div class="col-md-6">
        <h5>Text from PDF A</h5>
        <div class="border p-3" style="white-space: pre-wrap;">{{ diff_text_a|safe }}</div>
    </div>
    <div class="col-md-6">
        <h5>Text from PDF B</h5>
        <div class="border p-3" style="white-space: pre-wrap;">{{ diff_text_b|safe }}</div>
    </div>
</div>
{% endif %}

<div class="text-center mt-5">
    <a href="/" class="btn btn-secondary"><i class="bi bi-arrow-left me-2"></i>Compare New PDFs</a>
</div>

<script>
    let zoom = 1;

    function applyZoom() {
        document.getElementById('img1').style.transform = `scale(${zoom})`;
        document.getElementById('img2').style.transform = `scale(${zoom})`;
        document.getElementById('zoomInput').value = Math.round(zoom * 100);
    }

    function zoomIn() {
        if (zoom < 5) {
            zoom += 0.1;
            applyZoom();
        }
    }

    function zoomOut() {
        if (zoom > 0.25) {
            zoom -= 0.1;
            applyZoom();
        }
    }

    function resetZoom() {
        zoom = 1;
        applyZoom();
    }

    function setZoom(value) {
        const parsed = parseFloat(value);
        if (parsed >= 25 && parsed <= 500) {
            zoom = parsed / 100;
            applyZoom();
        }
    }
</script>
{% endblock %}
