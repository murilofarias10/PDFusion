{% extends 'base.html' %}
{% block title %}Processing PDFs{% endblock %}

{% block content %}
<section class="py-5">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="fw-bold">Processing Your PDFs</h2>
            <p class="text-muted">Please wait while we analyze your documents</p>
        </div>

        <!-- Progress Bar -->
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="progress mb-4" style="height: 15px;">
                    <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated"
                        role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
                </div>

                <!-- Status Message -->
                <div id="status-message" class="alert alert-info text-center mb-4">
                    Starting PDF processing...
                </div>

                <!-- Step List -->
                <div class="card mb-5">
                    <div class="card-header bg-primary text-white d-flex align-items-center">
                        <i class="bi bi-list-check me-2"></i>
                        <h5 class="mb-0 text-white">Processing Steps</h5>
                    </div>
                    <ul class="list-group list-group-flush processing-steps" id="processing-steps">
                        <li class="list-group-item d-flex justify-content-between align-items-center" id="step-upload">
                            <div>
                                <i class="bi bi-cloud-upload me-2"></i> Uploading Files
                            </div>
                            <span class="badge bg-secondary rounded-pill">Waiting</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center" id="step-extract">
                            <div>
                                <i class="bi bi-file-earmark-text me-2"></i> Extracting Content
                            </div>
                            <span class="badge bg-secondary rounded-pill">Waiting</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center" id="step-compare">
                            <div>
                                <i class="bi bi-search me-2"></i> Comparing Documents
                            </div>
                            <span class="badge bg-secondary rounded-pill">Waiting</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center" id="step-ai">
                            <div>
                                <i class="bi bi-robot me-2"></i> Analyzing Differences (AI)
                            </div>
                            <span class="badge bg-secondary rounded-pill">Waiting</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center" id="step-render">
                            <div>
                                <i class="bi bi-display me-2"></i> Rendering Output
                            </div>
                            <span class="badge bg-secondary rounded-pill">Waiting</span>
                        </li>
                    </ul>
                </div>
                
                <div class="text-center">
                    <p class="text-muted mb-4">This process usually takes 15-30 seconds depending on document size</p>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    const steps = ['upload', 'extract', 'compare', 'ai', 'render'];
    let progress = 0;
    let currentStep = 0;

    function updateStep(step, status) {
        const item = document.getElementById(`step-${step}`);
        const badge = item.querySelector('.badge');
        if (status === 'done') {
            badge.className = 'badge bg-success rounded-pill';
            badge.innerText = 'Completed';
        } else if (status === 'active') {
            badge.className = 'badge bg-primary rounded-pill';
            badge.innerText = 'In Progress';
        }
    }

    function nextStep() {
        if (currentStep >= steps.length) {
            document.getElementById('status-message').className = 'alert alert-success text-center mb-4';
            document.getElementById('status-message').innerText = "All steps completed. Redirecting...";
            setTimeout(() => window.location.href = "/processing/done", 2000);
            return;
        }

        const step = steps[currentStep];
        updateStep(step, 'active');
        
        let statusMessages = {
            'upload': 'Uploading your PDF files...',
            'extract': 'Extracting content from PDFs using OCR...',
            'compare': 'Analyzing and comparing document differences...',
            'ai': 'Generating AI insights about the changes...',
            'render': 'Preparing the final visualization...'
        };
        
        document.getElementById('status-message').innerText = statusMessages[step];

        setTimeout(() => {
            updateStep(step, 'done');
            currentStep++;
            progress += 20;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            document.getElementById('progress-bar').innerText = `${progress}%`;
            nextStep();
        }, 1500); // Slightly longer for more realistic feel
    }

    document.addEventListener('DOMContentLoaded', () => {
        nextStep();
    });
</script>

<style>
    .progress {
        height: 15px;
        border-radius: 50px;
        overflow: hidden;
    }
    
    .progress-bar {
        background-color: var(--primary);
        transition: width 0.5s ease;
    }
    
    .alert-info {
        background-color: rgba(3, 78, 145, 0.1);
        border-color: rgba(3, 78, 145, 0.2);
        color: var(--primary);
    }
    
    .alert-success {
        background-color: rgba(79, 127, 17, 0.1);
        border-color: rgba(79, 127, 17, 0.2);
        color: var(--secondary);
    }
    
    .badge.bg-success {
        background-color: var(--secondary) !important;
    }
    
    .badge.bg-primary {
        background-color: var(--primary) !important;
    }
    
    .card-header.bg-primary {
        background-color: var(--primary) !important;
    }
    
    .processing-steps .badge {
        padding: 0.6rem 0.8rem;
        font-weight: 500;
    }
    
    .list-group-item {
        padding: 1rem 1.5rem;
        font-family: 'Designer Regular', sans-serif;
    }
</style>
{% endblock %}
